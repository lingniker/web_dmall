<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/ys.css">

    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script>
        var $_331 = jQuery.noConflict();
    </script>
    <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
</head>
<body style="background-color: #eee">
<div class="toolbar">
    <a class="back" href="./i.user.html"><div class="back-into"></div></a>
    <span>地址管理</span>
    <!--<a href="i.addaddress.html" class="addadress">新增地址</a>-->
</div>
<div class="wap_coupon">
<ul id="address_ul">
</ul>
<div  class="address_addnew0">
    <a class="address_addnew" href="i.addaddress.html">+ 新建地址</a>
</div>
</div>
</body>
</html>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<script>
    var $3_3_1 = jQuery.noConflict(true);
    var mykey = "union_supermarket_2018";
    var url = "http://140.143.25.27:8080/";
    if(sessionStorage.access_token !== undefined){
        var obj = {};
        obj.access_token = sessionStorage.access_token;
        obj.timestamp= parseInt(new Date().getTime()/1000);
        obj.from = "web";
        var str = srotKeyObjAndMd5(obj);
        var newUrl = url + "address/get?" + str;
        $_331.ajax({
            url:newUrl,
            type:"get",
            dataType:"json",
            success:function(data){
                console.log(data);
                console.log(data.data);

                var nodestr = "";
                for(var i=0;i<data.data.length;i++){
                    nodestr += "<li>"+"<div class='address_1'>"+
                        "<div class='address_2'>"+
                        "<div class='address_2_1'>"+"<span class='address_2_1_1'>"+data.data[i].name+"</span>"+"<span class='address_2_1_2'>"+
                        data.data[i].phone.slice(0,3)+"****"+data.data[i].phone.slice(7,11)+"</span>"+"</div>"+
                        "<div class='address_2_2'>"+data.data[i].addres+" "+data.data[i].doorplate+"</div>"+
                        "</div>"+
                        "<div class='address_3'>"+
                        "<div class='address_3_1'>"+"<input type='radio' name='r' class='address_3_1_1' id=''>"+"<span class='address_3_1_2'>"+"设为默认"+"</span>"+"</div>"+
                        "<div class='address_3_2'>"+
                        "<a href='#' class='address_3_2_a2' onclick='del(i)'>"+"<div class='address_3_2_img2'>"+"</div>"+"<button>"+"删除"+"</button>"+"</a>"+
                        "<a href='i.modifyaddress.html' class='address_3_2_a1' >"+"<div class='address_3_2_img1'>"+"</div>"+"<span>"+"编辑"+"</span>"+"</a>"
                        +"</div>"
                        +"</div>"
                        +"</div>"+"</li>"
                }

                $_331(document).ready(function(){
                    $_331("#address_ul").html(nodestr)
                });
            },
            error:function(err){
                console.log(err);
            }
        });
    }else{

    }


    function del(n) {
         // var wap=document.getElementById("wap");
         if(confirm("地址删除后无法恢复，是否要删除地址？")){
             // alert("1111111111111");
             // document.getElementById("address_1").innerHTML="";
             // clear.style.display="none";
             // location.href="i.address.html";
             // document.getElementById("address_1").style.display="none";


             var s=document.getElementById("address_ul");
             var t=s.childNodes.length;
             // var list=document.getElementsByTagName("li");
             for ( var i=0;i<t;i++){
                 // list[i].index=i;
                 if(i==n)
                 {
                     // this.style.display="none";
                     s.removeChild(s.childNodes[i]);
                     // s.style.display="none";

                 }

             }

             // document.getElementById("address_1").style.display="none";

         }else {
         }


     }



    function srotKeyObjAndMd5(obj){
        var arr = [];
        var newobj = {};
        for(var key in obj){
            arr.push(key);
        }
        arr.sort();
        var i=0;
        for(var key in obj){
            newobj[arr[i]] = obj[arr[i]];
            i++;
        };
        var str = '';
        for(var key in newobj){
            str += key +"="+ newobj[key] + "&";
        }
        var newstr = str.substr(0,str.length-1);

        var encodeStr = encodeURIComponent(newstr) + mykey;
        var sign = md5(encodeStr);
        newstr += "&sign=" + sign;
        return newstr;
    }
</script>
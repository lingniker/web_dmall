<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>购物车</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/ys.css">

</head>
<body style="background-color: #eee">
<div class="wap_shopping">
    <div class="toolbar">
        <a class="back" href="./i.index.html"><div class="back-into"></div></a>
        <span>购物车</span>
    </div>
    <div class="shopping_main">
        <ul id="shopping_ul">
            <li>
                <div class="shopping_li_checked">
                    <div class="shopping_li_checked_01  item01 ">
                        <input id="item1" type="checkbox" name="item" value="" >
                        <label for="item1" class="label_shopping"></label>
                        <span style="margin-left: 10px" class="span_shopping"></span>
                    </div>
                </div>
                <div class="shoping_li_img">
                    <img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2345459846,1574162539&fm=27&gp=0.jpg" class="shoping_li_img_01">
                </div>
                <div class="shopping_value">
                    <div class="shopping_cart_1"><span>北京昌平有机园草莓</span><span>1kg</span><span></span></div>
                    <div class="shopping_cart_2">
                        <div class="shopping_cart_2_1">￥<span>12.8</span></div>
                        <div class="shopping_cart_2_2"><div class="shoping_reduce">-</div><input type="text" value="1" class="shoping_quantity"><div class="shopping_add">+</div></div>
                    </div>
                </div>
            </li>
            <li>
                <div class="shopping_li_checked">
                    <div class="shopping_li_checked_01  item01 ">
                        <input id="item3" type="checkbox" name="item" value="" >
                        <label for="item3" class="label_shopping"></label>
                        <span style="margin-left: 10px" class="span_shopping"></span>
                    </div>
                </div>
                <div class="shoping_li_img">
                    <img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2345459846,1574162539&fm=27&gp=0.jpg" class="shoping_li_img_01">
                </div>
                <div class="shopping_value">
                    <div class="shopping_cart_1"><span>北京昌平有机园草莓</span><span>1kg</span><span></span></div>
                    <div class="shopping_cart_2">
                        <div class="shopping_cart_2_1">￥<span>12.8</span></div>
                        <div class="shopping_cart_2_2"><div class="shoping_reduce">-</div><input type="text" value="1" class="shoping_quantity"><div class="shopping_add">+</div></div>
                    </div>
                </div>
            </li>

            <li>
                <div class="shopping_li_checked">
                    <div class="shopping_li_checked_01  item01 ">
                        <input id="item2" type="checkbox" name="item" value="" >
                        <label for="item2" class="label_shopping"></label>
                        <span style="margin-left: 10px" class="span_shopping"></span>
                    </div>
                </div>
                <div class="shoping_li_img">
                    <img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2345459846,1574162539&fm=27&gp=0.jpg" class="shoping_li_img_01">
                </div>
                <div class="shopping_value">
                    <div class="shopping_cart_1"><span>北京昌平有机园草莓</span><span>1kg</span><span></span></div>
                    <div class="shopping_cart_2">
                        <div class="shopping_cart_2_1">￥<span>12.8</span></div>
                        <div class="shopping_cart_2_2"><div class="shoping_reduce">-</div><input type="text" value="1" class="shoping_quantity"><div class="shopping_add">+</div></div>
                    </div>
                </div>
            </li>

            <li>
                <div class="shopping_li_checked">
                    <div class="shopping_li_checked_01  item01 ">
                        <input id="item4" type="checkbox" name="item" value="" >
                        <label for="item4" class="label_shopping"></label>
                        <span style="margin-left: 10px" class="span_shopping"></span>
                    </div>
                </div>
                <div class="shoping_li_img">
                    <img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2345459846,1574162539&fm=27&gp=0.jpg" class="shoping_li_img_01">
                </div>
                <div class="shopping_value">
                    <div class="shopping_cart_1"><span>北京昌平有机园草莓</span><span>1kg</span><span></span></div>
                    <div class="shopping_cart_2">
                        <div class="shopping_cart_2_1">￥<span>12.8</span></div>
                        <div class="shopping_cart_2_2"><div class="shoping_reduce">-</div><input type="text" value="1" class="shoping_quantity"><div class="shopping_add">+</div></div>
                    </div>
                </div>
            </li>



        </ul>
    </div>

</div>
<div class="shoping_footer">
    <div class="shoping_footer_1">
        <div class="shopping_li_checked_01 " style="margin-top: 10px;margin-left: -20px;float: left" id="allSelected">
            <input id="item0" type="checkbox" name="item" value="" class="allSelected2" >
            <label for="item0" class="label_shopping"></label>
            <span style="margin-left: 10px" class="span_shopping"></span>
        </div>
        <div class="shopping_li_checked_02">全选</div>

    </div>
    <div class="shoping_footer_2">
        <div class="shoping_footer_2_2"><a href="#" style="color: white">结算(<span>0</span>)</a></div>
        <div class="shoping_footer_2_1">
            <div class="shoping_footer_2_1_1">合计：<span>￥</span><span>0.00</span></div>
            <div class="shoping_footer_2_1_2">
                <input type="checkbox" value="">
                <span>携带垃圾</span>
            </div>
        </div>

    </div>

</div>
</body>
</html>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<script src='scripts/myOrder.js'></script>
<script>
    //mobile中fixed全选
    $('#allSelected').on('click','.allSelected2',function(event){
        if ($(this).prop('checked')) {
            $(':checkbox').prop('checked',true);
            $('#shopping_ul li').css({
                'background-color':'#ffdf94'
            });
        } else {
            $(':checkbox').prop('checked',false);
            $('#shopping_ul li').css({
                'background-color':'#fcfcfc'
            });
        }
        getCountMobile();
    })

    //mobile中点击某商品时选中
    $('body').on('click','.item01 input',function(event){
        if ($(this).prop('checked')) {
            // $(this).parents('.commodityInfo').siblings('.shopInfo1').find('input').prop('checked',true);
            $(this).parent().parent().parent().find(' li').css({
                'background-color':'#ffdf94'
            });
        } else {
            // $(this).parents('.commodityInfo').siblings('.shopInfo1').find('input').prop('checked',false);
            $(this).parents('#shopping_ul li').css({
                'background-color':'#fcfcfc'
            });
        }
        cancelSelectMobile();
        getCountMobile();
    });

    //mobile中点击某商品时选中
    $('body').on('click','.shopInfo1 input',function(event){
        if ($(this).prop('checked')) {
            $(this).parents('.shopInfo1').siblings('.commodityInfo').find('.td-inner1 input').prop('checked',true);
            $(this).parents('.shopInfo1').siblings('.commodityInfo').css({
                'background-color':'#fff8e1'
            });
        } else {
            $(this).parents('.shopInfo1').siblings('.commodityInfo').find('.td-inner1 input').prop('checked',false);
            $(this).parents('.shopInfo1').siblings('.commodityInfo').css({
                'background-color':'#fcfcfc'
            });
        }
        cancelSelectMobile();
        getCountMobile();
    });

    //商品数量的输入框
    $('body').on('keypress keyup blur','.changeCount input',function(event){
        if (event.type==='keypress') {
            var thisParent = $(this).parents('.td-amount');
            var thisInput = $(this).parent('.item-amount');
            var $text = thisParent.siblings('.td-price').find('span').text();
            var tdSum = thisParent.find('.td-sum').children('span');
            var keyCode = event.keyCode ? event.keyCode : event.charCode ;
            if (keyCode !== 0 && (keyCode <48 || keyCode >57) && keyCode!==8 && keyCode !==37 && keyCode !==39 && keyCode !==46) {
                return false;
            } else {
                return true;
            };
        } else if(event.type ==='keyup'){
            var thisParent = $(this).parents('.td-amount');
            var thisInput = $(this).parent('.item-amount');
            var $text = thisParent.siblings('.td-price').find('span').text();
            var tdSum = thisParent.siblings('.td-sum').find('span');
            var keyCode = event.keyCode ? event.keyCode : event.charCode ;
            if (keyCode !== 8) {
                var num = parseInt($(this).val()) || 0;
                num = num < 1 ? 1 : num;
                var num = $(this).val();
                tdSum.text($text * num + '.00');
            };
            var anNum = $(this).val();
            tdSum.text($text * anNum +'.00');
            getCount();
        } else {
            var thisParent = $(this).parents('.td-amount');
            var thisInput = $(this).parent('.item-amount');
            var $text = thisParent.siblings('.td-price').find('span').text();
            var tdSum = thisParent.siblings('.td-sum').find('span');
            var keyCode = event.keyCode ? event.keyCode : event.keyCode;
            var num = parseInt($(this).val()) || 0;
            num = num < 1 ? 1 : num ;
            $(this).val(num);
            var anNum = $(this).val();
            tdSum.text($text * anNum +'.00');
            getCount();
        }
    });




    //Mobile商品数量增加
    $('body').on('click','.plusCount',function(event){
        var thisParentS = $(this).parents('.shopInfo1').siblings('.commodityInfo');
        var unitPrice = thisParentS.find('.unitPrice').text();
        var thisInput = $(this).parent('.changeCount');
        var $sum = thisParentS.find('.discount');
        var $text = thisParentS.find('.discount').text();
        var num = thisInput.find('input').val();
        num++;
        thisInput.find('input').val(num);
        $sum.text(unitPrice * num + '.00');
        getCountMobile();
        return false;
    });

    //Mobile商品数量减少
    $('body').on('click','.substrCount',function(event){
        var thisParentS = $(this).parents('.shopInfo1').siblings('.commodityInfo');
        var unitPrice = thisParentS.find('.unitPrice').text();
        var thisInput = $(this).parent('.changeCount');
        var $sum = thisParentS.find('.discount');
        var $text = thisParentS.find('.discount').text();
        var num = thisInput.find('input').val();
        if (num>1) {
            num--;
            thisInput.find('input').val(num);
        }
        $sum.text(unitPrice * num + '.00');
        getCountMobile();
        return false;
    });

    //Mobile商品数量减少
    $('body').on('click','.amount-left',function(event){
        var thisParent = $(this).parents('.td-amount');
        var thisInput = $(this).parent('.item-amount');
        var $text = thisParent.siblings('.td-price').find('span').text();
        var tdSum = thisParent.siblings('.td-sum').find('span');
        var num = thisInput.find('input').val();
        if (num > 1 ) {
            num--;
            thisInput.find('input').val(num);
        }
        tdSum.text($text * num +'.00');
        getCount();
        return false;
    });

    //mobile中取消全选
    function cancelSelectMobile(){
        if ($('.item01 input').length === $('.item01 input:checked').length) {
            $('.allSelected2').prop('checked',true);
            $('#shopping_ul li').css({
                'background-color':'white'
            });

        } else {
            $('.allSelected2').prop('checked',false);
            $('#shopping_ul li').css({
                'background-color':'white'
            });
        }
    }


    //mobile中获得已选中商品和商品价格总额
    function getCountMobile(){
        var counts = 0;
        var sum = 0;
        $('.td-inner1 input').each(function(index, el) {
            if ($(this).prop('checked')) {
                for (var i = 0; i < $(this).length; i++) {
                    counts += parseInt($(this).parents('.td-chk').siblings('.td-info1').find('.discount').text());
                    sum += 1;
                }
            }
        });
        $('.totalSum').text(sum);
        $('.total-sum').html((counts).toFixed(2));
    };


</script>
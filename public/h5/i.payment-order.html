<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/ys.css">
</head>
<body style="background-color: #eee">
<div class="wap_coupon">
    <div class="toolbar">
        <a class="back" href="./i.shopping.html"><div class="back-into"></div></a>
        <span>支付订单</span>
    </div>
    <div class="payment-order01">
        <div class="payment-order02">
            <div class="payment-order02_01">
            <div class="payment-order02_img"><img src="images/payment_ordertime01.png"></div>
            <div class="payment-order02_1">
                <div class="payment-order02_2">支付剩余时间</div>
                <div class="payment-order02_3">
                    <span id="minute"></span>
                    <!--<span id="fen1"></span> -->
                    :
                    <span style="margin-left: 3px" id="second"></span>
                    <!--<span id="miao2"></span>-->
                </div>
            </div>
            </div>
        </div>
        <div class="payment-order03">订单金额: ￥<span class="payment-order03_1">217.80</span></div>
    </div>
     <div class="payment-method">选择支付方式</div>
        <!--<div class="recharge_payment-method" style="background-color: white">-->
            <!--<a href="#" class="recharge_pay_2_4_2_a6" ><div class="recharge_pay_2_4_2_img6" style="margin-top: 10px"></div>-->
                <!--<span class="recharge_pay_2_4_2_a6_span1">余额包支付<span class="recharge_pay_2_4_2_a6_span2">余额不足</span>-->
                <!--</span>-->

             <!--&lt;!&ndash;<input type="checkbox" class="inpt01">&ndash;&gt;-->
            <!--</a>-->
            <!--<a href="#" class="recharge_pay_2_4_2_a1"  ><div class="recharge_pay_2_4_2_img1" style="margin-top: 10px"></div><span>支付宝支付</span>-->
               <!--</a>-->
            <!--<a href="#" class="recharge_pay_2_4_2_a2" ><div class="recharge_pay_2_4_2_img2" style="margin-top: 10px"></div><span>微信支付</span></a>-->
            <!--<a href="#" class="recharge_pay_2_4_2_a4" ><div class="recharge_pay_2_4_2_img4" style="margin-top: 10px"></div><span>银联支付</span></a>-->
            <!--<a href="#" class="recharge_pay_2_4_2_a5" ><div class="recharge_pay_2_4_2_img5" style="margin-top: 10px"></div><span>快捷支付</span></a>-->
            <!--<a href="#" class="recharge_pay_2_4_2_a3" ><div class="recharge_pay_2_4_2_img3" style="margin-top: 10px;"></div><span>京东支付</span></a>-->
            <!--<div style="width: 100%;height: 100px"></div>-->

        <!--</div>-->
    <ul class="payment-method_1">
        <li class="payment-method01"><div class="payment-method01-img"></div><div class="payment-method01-value">
            <span class="payment-method01-value01">余额支付</span><span class="payment-method01-value02">余额不足</span></div>
            <div class="payment-method_input"><div class="payment-method_input_img"></div></div>
        </li>
        <li class="payment-method01">
            <div class="payment-method01-img02"></div><div class="payment-method01-value-01"><span class="payment-method01-value03">支付宝支付</span></div>
        <div class="payment-method_input">
            <div class="payment-method_input_img01"></div>
            <div class="payment-method_input_img02"></div>
        </div>
        </li>
        <li class="payment-method01"><div class="payment-method01-img03"></div><div class="payment-method01-value-01"><span class="payment-method01-value03">微信支付</span></div>
            <div class="payment-method_input"><div class="payment-method_input_img"></div></div>
        </li>
        <li class="payment-method01"><div class="payment-method01-img04"></div><div class="payment-method01-value-01"><span class="payment-method01-value03">银联支付</span></div>
            <div class="payment-method_input"><div class="payment-method_input_img"></div></div>
        </li>
        <li class="payment-method01"><div class="payment-method01-img05"></div><div class="payment-method01-value-01"><span class="payment-method01-value03">快捷支付</span></div>
            <div class="payment-method_input"><div class="payment-method_input_img"></div></div>
        </li>
        <li class="payment-method01"><div class="payment-method01-img06"></div><div class="payment-method01-value-01"><span class="payment-method01-value03">京东支付</span></div>
            <div class="payment-method_input"><div class="payment-method_input_img"></div></div>
        </li>
    </ul>
     <div style="width: 100%;height: 100px"></div>

    <div class="payment-method—pay">
        <div class="payment-method—pay01">确认支付: ￥<span class="payment-method—pay02">217.80</span></div>
    </div>


</div>
</body>
</html>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<!--接口-->
<script src="js/wys.js"></script>
<script>

    // var $3_3_1 = jQuery.noConflict(true);
    if (sessionStorage.unpaidNo==undefined){

        $(".payment-order03_1").html(sessionStorage.discountedMoney);
        $(".payment-method—pay02").html(sessionStorage.discountedMoney);
        var minute = 29;
        var second = 59;
        setInterval(function() {
            second--;
            if(second == 00 && minute == 00) {
                minute = 29;
                second = 59;
            }; //当分钟和秒钟都为00时，重新给值
            if(second == 00){
                second = 59;
                minute--;
                if(minute < 10) minute = "0" + minute;
            }; //当秒钟为00时，秒数重新给值
            if(second < 10) second = "0" + second;
            $("#minute").text(minute);
            $("#second").text(second);

            // alert(minute+second+minute.slice(0,1)+second.slice(0,1));
            // $("#minute").text(minute.slice(0,1));
            // $("#fen1").text(minute.slice(1,2));
            // $("#second").text(second.slice(0,1));
            // $("#miao2").text(second.slice(1,2));
        }, 1000);
    } else {

        $(".payment-order03_1").html(sessionStorage.unpaidPaymoney);
        $(".payment-method—pay02").html(sessionStorage.unpaidPaymoney);
        var minute = sessionStorage.minuteTime;
        var second = sessionStorage.secondTime;
        setInterval(function() {
            second--;
            if(second == 00 && minute == 00) {
                minute = 29;
                second = 59;
            }; //当分钟和秒钟都为00时，重新给值
            if(second == 00){
                second = 59;
                minute--;
                if(minute < 10) minute = "0" + minute;
            }; //当秒钟为00时，秒数重新给值
            if(second < 10) second = "0" + second;
            $("#minute").text(minute);
            $("#second").text(second);

            // alert(minute+second+minute.slice(0,1)+second.slice(0,1));
            // $("#minute").text(minute.slice(0,1));
            // $("#fen1").text(minute.slice(1,2));
            // $("#second").text(second.slice(0,1));
            // $("#miao2").text(second.slice(1,2));
        }, 1000);
    }




//单选框点击
// $(".payment-method_input_img01").click(function () {
//     // alert("5222")
//     // $(".payment-method_input_img01").css({' background-image':'url("../images/payment01.png")'});
//     $(".payment-method_input_img01").css({'display':'none'});
//     $(".payment-method_input_img02").css({'display':'block'});
//
// });
//     $(".payment-method_input_img02").click(function () {
//         $(".payment-method_input_img01").css({'display':'block'});
//         $(".payment-method_input_img02").css({'display':'none'});
//     });
    $(".payment-method_input_img").click(function () {
        alert("还没开通这种支付方式!");
    });





    $(".payment-method—pay").on("click",function () {
        if(sessionStorage.access_token !== undefined) {
         if(minute==0&&second==0){
             alert("支付超时，请重新下单支付!");
         }else {
            var obj = {};
            obj.access_token=sessionStorage.access_token;
            obj.storeId=sessionStorage.storeId;
            obj.shoppingCartId=sessionStorage.shoppingCartId;
            obj.timestamp= parseInt(new Date().getTime()/1000);
            obj.from = "web";
            var str = srotKeyObjAndMd5(obj);
            var newUrl = url + "order/settlement?" + str;
            console.log("数据列表");
            console.log(newUrl);
            // $.ajax({
            //     url:newUrl,
            //     type:"GET",
            //     dataType:"json",
            //     success:function(data){
            //         console.log(data);
            //         console.log("ok");
            //         // alert("ok！");
            //         // $_331(self).parent().parent().parent().parent().remove();
            //         alert(data.data.payTypes[0].notifyUrl);
            //         $(".payment-method—pay").attr("href",data.data.payTypes[0].notifyUrl);
            //     },
            //     error:function(err){
            //         console.log(err);
            //     }
            // });
         }

        }
    });

    //清空此页用到的session
    $(".back").click(function () {
        sessionStorage.unpaidPaymoney=undefined;
        sessionStorage.discountedMoney=undefined;
    });

    function srotKeyObjAndMd5(obj){
        var arr = [];
        var newobj = {};
        for(var key in obj){
            arr.push(key);
        }
        arr.sort();
        var i=0;
        for(var key in obj){
            newobj[arr[i]] = obj[arr[i]];
            i++;
        };
        var str = '';
        for(var key in newobj){
            str += key +"="+ newobj[key] + "&";
        }
        var newstr = str.substr(0,str.length-1);

        var encodeStr = encodeURIComponent(newstr) + mykey;
        var sign = md5(encodeStr);
        newstr += "&sign=" + sign;
        return newstr;
    }

</script>
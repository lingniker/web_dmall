<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="myadmin/assets/css/bootstrap.css" rel="stylesheet" />
    <link href="myadmin/assets/css/font-awesome.css" rel="stylesheet" />
    <link href="myadmin/assets/js/morris/morris-0.4.3.min.css" rel="stylesheet" />
    <link href="myadmin/assets/css/custom-styles.css" rel="stylesheet" />
    <link href="myadmin/css/common.css" rel="stylesheet">
    <!-- <link href='http://fonts.useso.com/css?family=Open+Sans' rel='stylesheet' type='text/css' /> -->
    <title>店铺管理</title>
</head>
<style>
    .data-title{
        height: 44px;
        margin-bottom: 20px;
        background: #fff;
    }
    .data-title p{
        padding:12px 0 0 12px;
    }
    .data-body{
        width: 100px;
        overflow: auto;
    }
    .body-left-ul li:hover{
        background: #575757;
        color: #F36A5A;  
    }
    .body-data-box{
        height: 120px;
        width: 100%;
        padding-right: 10px;
        background: white;
    }
    .row-box{
        padding:15px;
    }
    .body-data-num{
        padding: 0px;
    }
    .body-data-name{
        padding: 0px 0px 0px 20px;
        font-size: 16px;
        color: #AAB5BC;
        font-weight: 600;
        text-transform: uppercase;        
    }
    .body-data-num{
        padding: 30px 0px 0px 20px;
        font-size: 32px;
        font-weight: 600;
        color: #676767;
    }
    .store-manage-li{
        height: 40px;
        line-height: 40px;
        padding: 5px 0px;
        margin: 20px 0px;     
    }
    .store-manage-li input{
        width: 450px;
        margin-right: 20px;
        padding-left: 10px;
    }
    .add-store {
        height: 24px;
        position: relative;
        overflow: hidden;
        margin-top:40px;
        /* overflow:visible; */
    }
    #add-store-btn{
        display: inline-block;
        padding: 0 10px;
        width: 35px;
        height: 24px;
        margin-left: 20px;
    }
    .input-store{
        width: 450px;
        height: 30px;
        position: absolute;
        top: 30px;
    }
    .input-store .store-manage-li input{
        width: 400px;
        height: 35px;
        padding-left: 10px;
    }
    .store-manage .store-manage-li button{
        padding: 0px 10px;
        margin: 0px 2px;
    }
    .input-store .store-manage-li button{
        height: 34px;
        margin: 0 2px;
        padding: 0 5px;
    }
    .store-panel{
        padding:5px;
    }
    .goods-page-ul li{
        float: left;
        /* width: 24px; */
        height: 24px;
        padding: 0px 6px;
        border: 1px solid gray;
        text-align: center;
        cursor: pointer;
    }
    .goods-page-ul li:hover{
        background: #ddd;
    }
    .goods-li{
        width:45%;
        margin: 10px 10px 0 10px;
        height:30px;
        line-height: 30px;
        border:1px solid gray;
        overflow: hidden;
        padding: 0px 18px 0px 5px;
        border-radius: 4px;
        position: relative;
    }
    .goodsCheck{
        position:absolute;
        width: 10px;
        height: 30px;
        top:0px;
        right:10px;
    }
    .active{
        color:#F36A5A;
    }
    .mymodal{
        margin-top:50px;
    }

    /*********店铺查找*****************************/
    .search_store{
        width: 90%;
        height: 35px;
        line-height: 35px;
        float:right;
        font-size: 16px;
    }
    .findStort{
        display: inline-block;
        padding: 6px 12px;
        margin-top: 0;
        /*margin-bottom: 0;*/
        font-size: 14px;
        font-weight: 400;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        -ms-touch-action: manipulation;
        touch-action: manipulation;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background-image: none;
        border: 1px solid transparent;
        border-radius: 4px;
        color: #fff;
        background-color: #337ab7;
        border-color: #2e6da4;
        -webkit-appearance: button;

        float: right;
        margin-right: 458px;
    }
    .search_input1{
        width: 250px;
        height: 35px;
        float: right;
        margin-right: 10px;
        padding-left: 20px;
        font-size: 13px;
    }
    .search_input2{
        width: 250px;
        height: 35px;
        float: right;
        margin-right: 10px;
        padding-left: 20px;
        font-size: 13px;
    }
</style>
<body>
    <div class="admin-container">
        <div class="admin-nav">
            <div class="admin-nav-left">联家管理系统</div>
            <div class="admin-nav-right">
            <div class="store-name" style="position:absolute;left:290px;top:9px;font-size:30px;"></div>
            <div class="back-login"><a href="#">退出登录</a></div>
            </div>
        </div>
        <div class="body">
            <div class="body-left">
                <ul class="body-left-ul">
                        <li class="active"><a href="./store-info.html">店铺信息</a></li>
                        <li><a href="./store-order.html">订单查询</a></li>
                </ul>
            </div>
            <div class="body-right">
            <div class="body-right-title">店铺管理</div>
            <div class="body-right-data">
                <div class="add-advertising" style="padding-bottom:30px;">
                    <!--<button type="button" class="btn btn-primary admin-btn" data-toggle="modal" data-target="#exampleModal" data-api="store/add?" data-whatever="增加店铺" -->
                    <!--data-list="storeName_商品名称:^:例：高密联家超市1号店4&%_%&longitude_经度坐标:^:例：119.1070784&%_%&latitude_纬度坐标:^:例：36.709254&%_%&positionName_地址名称:^:例：山东省潍坊-->
                    <!--市潍城区城关街道胜利西街9号潍坊百货大楼和平路4">增加店铺</button>                   -->
                <!--<div class="search_store">-->
                    <!--<span class="search_span">店铺查找:</span>-->
                    <!--<button class="findStort">查找</button>-->
                    <!--<input type="text" class="search_input1" placeholder="请输入店铺id" id="search_input1" value="">-->
                <!--</div>-->
                </div>
                <ul class="store-manage">              
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

                        </div>
                </ul>
            </div>
        </div>
        <div class="floor"></div>
    </div>

    <!-- 公用的模态框 -->
    <div class="modal fade mymodal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="exampleModalLabel">消息</h4>
            </div>
            <div class="modal-body append-form">
               <!-- 存放输入框的信息 -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
              <button type="button" class="btn btn-primary" id="modal-commit">提交</button>
            </div>
          </div>
        </div>
    </div>

    <!-- 商品管理模态框 -->
    <div class="modal fade bs-example-modal-lg1 goodsModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
        <div class="modal-dialog modal-lg" role="document">
          
          <div class="modal-content" style="padding:0 10px">
           <h3>商品管理</h3>
           <hr>
            <button class="btn onSale active goodsOne" data-api="product/findOnSaleByStoreId?">在售商品</button>
            <button class="btn notSold goodsTwo" data-api="product/findNoSaleByStoreId?">未上架商品</button>
            <div style="display:inline-block;"><input type="text" class="select-goods" style="height:32.5px;vertical-align:middle;margin:0 6px 0 10px;border-radius:5px;border:1px gray solid "><button class="btn find-goods-btn" data-api="product/findOnSaleByStoreId?">查找商品</button></div>
            <!-- <button class="btn allGoods goodsThree">所有商品</button> -->
            <div class="goodsBox" style="width:100%;padding-bottom:60px;height:auto;position:relative;">
                <ul style="width:100%;display:flex;flex-wrap:wrap;" class="goods-ul">
                        <!-- 商品详情 -->
                </ul>
                <div class="page" style="padding-top:4px;padding-left:10px;position:absolute;width:300px;bottom:10px;">
                    <ul class="goods-page-ul" style="margin-bottom:0px">
                        <!-- 分页 -->
                    </ul>
                </div>
                <button class="btn btn-primary modifyGoods" data-api="storeProduct/saveList?" style="position:absolute;bottom:4px;right:57px;">下架选中商品</button>
            </div>
          </div>
        </div>
      </div>
</div>


    <script src="myadmin/assets/js/jquery-1.10.2.js"></script>
    <script src="myadmin/assets/js/bootstrap.min.js"></script>
    <script src="myadmin/assets/js/jquery.metisMenu.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
    <script type="text/javascript" src="myadmin/js/config.js"></script>
    <!-- <script src="../cdn/jquery3.3.1.min.js"></script>
    <script src="../cdn/md5.min.js"></script> -->
    <script>

        var $_331 = jQuery.noConflict();
        console.log("url",url);
        var storeId = 0;
        var state = "on";

        (function(){
        $('.collapse').collapse();
        //模态框的弹出
        $('#exampleModal').on('show.bs.modal', function(event){
            var button = $(event.relatedTarget);
            var recipient = button.data('whatever');
            var list = button.data('list');
            var a = list.split('&%_%&');
            // console.log(a);
            var obj = {};
            var arr = [];
            for(var i in a){
                // console.log(a[i]);
                arr[i] = [];
                arr[i][0] = a[i].split(":^:")[0];
                arr[i][1] = a[i].split(":^:")[1].substr(0,a[i].split(":^:")[1].length-1) == "|*-*|" ? "" : a[i].split(":^:")[1].substr(0,a[i].split(":^:")[1].length-1);
                arr[i][2] = a[i].split(":^:")[1].substr(a[i].split(":^:")[1].length-1,1);
            }
            // console.log(arr);
            
            //增加节点name_名字:0&%_%&age_年龄:1&%_%&phone_手机:2
            var appendNode = '<ul class="list-group" id="modal-list"><li class="list-group-item" id="modal-list">';
            
            for(var i = 0; i<arr.length ;i++){
                if(arr[i][2] == 9){
                    // console.log("添加图片");
                    appendNode +='<div class="form-group"><label for="exampleInputFile">选择图片</label><input id="img-input" type="file" filetype="image/*" name="'
                    +arr[i][0].split('_')[0]
                    +'"><p class="help-block"></p><button class="btn_img btn">点击上传</button></div>';
                }else if(arr[i][2] == 8){
                    appendNode +='<div class="form-group"><label for="'
                    +a[i].split(':^:')[0].split('_')[0]
                    +'" class="control-label">'
                    +a[i].split(':^:')[0].split('_')[1]
                    +'</label><input type="text" data-enable-time=true data-time_24hr=true  data-enable-seconds=true class="form-control flatpickr" id="index" name="'
                    +a[i].split(':^:')[0].split('_')[0]+'"></div>';
                }else if(arr[i][2] == 4){
                    appendNode += '<div class="form-group"><label for="'
                    +arr[i][0].split('_')[0]+'" class="control-label">'
                    +arr[i][0].split('_')[1]
                    +'</label><input type="text" class="form-control" id="index" name="'
                    +arr[i][0].split('_')[0]
                    +'" placeholder="'
                    +arr[i][1]
                    +'"></div>';
                }else if(arr[i][2]==3){
                    appendNode += '<div class="form-group" style="display:none;"><label for="'
                    +arr[i][0].split('_')[0]+'" class="control-label">'
                    +arr[i][0].split('_')[1]
                    +'</label><input type="text" readonly="readonly" class="form-control" id="'
                    +arr[i][0].split('_')[0]+'" name="'
                    +arr[i][0].split('_')[0]+
                    '" value="'
                    +arr[i][1]+
                    '"></div>';
                }else if(arr[i][2] == 2){
                    appendNode += '<div class="form-group" style="display:none;"><label for="'
                    +arr[i][0].split('_')[0]+'" class="control-label">'
                    +arr[i][0].split('_')[1]
                    +'</label><input type="text" class="form-control" id="index" name="'
                    +arr[i][0].split('_')[0]
                    +'" placeholder="'
                    +arr[i][1]
                    +'"></div>确定删除商店';              
                }else{
                    appendNode += '<div class="form-group"><label for="'
                    +arr[i][0].split('_')[0]+'" class="control-label">'
                    +arr[i][0].split('_')[1]
                    +'</label><input type="text" class="form-control" id="'
                    +arr[i][0].split('_')[0]+'" name="'
                    +arr[i][0].split('_')[0]+
                    '" value="'
                    +arr[i][1]+
                    '"></div>';
                };
            }
            appendNode += '</li></ul>';
            $(".append-form").html(appendNode);
            // document.getElementsByClassName("flatpickr").flatpickr();
            var modal = $(this);
            modal.find('.modal-title').text(recipient);
            $("#modal-commit").data("api",button.data("api"));
            // modal.find('.modal-body input').val(recipient);
        });



        //模态框内容的提交
        $("#modal-commit").on('click',function(){

            var api = $(this).data("api");
            console.log(api);
            if(api == "store/add?"){//商店添加
                
                var data = {};
                for(var i=0; i<$("#modal-list .form-group").length;i++){
                    if($("#modal-list .form-group").eq(i).find("input").attr("type")=="file"){
                        alert("请先上传图片");
                        return;
                    }else{
                            data[$("#modal-list .form-group").eq(i).find("input").attr("name")] = $("#modal-list .form-group").eq(i).find("input").val();
                    }
                };
                var longreg =data.longitude;
                var latreg =data.latitude;
                if(/^-?(([1-9]\d?)|(1[1-7]\d)|180)(\.\d{1,10})?$/.test(longreg)){
                    if(/^-?(([1-9])|([1-8]\d)|90)(\.\d{1,10})?$/.test(latreg)){
                        if(data.storeName.length<40&data.storeName.length>0&data.storeName!==" "){
                             if (data.positionName.length<50&data.positionName.length>0&data.positionName!==" "){
                                 data.access_token = sessionStorage.access_token;
                                 data.from = "web";
                                 data.createUser = sessionStorage.id;
                                 data.timestamp = parseInt(new Date().getTime() / 1000);

                                 var newObj = srotKeyObj(data);
                                 var str = objmd5(newObj);

                                 var newUrl = url + api + str;
                                 console.log(newUrl);

                                $.ajax({
                                    url:newUrl,
                                    type:'get',
                                    success:function(data){
                                        console.log(data);
                                        console.log("ok");
                                        alert("增加成功");
                                        location.reload();
                                    },
                                    error:function(err){
                                        console.log(err);
                                        console.log("err");                                       
                                    }
                                });
                             }else {
                                 alert("店铺地址输入错误且不能超过50个字符!");
                             }
                        }else {
                            alert("店铺名称输入错误且不能超过40个字符!");
                        }
                    } else {
                         alert("纬度输入错误!");
                    }
                }else {
                    alert("经度输入错误!");
                }

            }else if(api == "store/update?"){//商店更新

              var data = {};
                for(var i=0; i<$("#modal-list .form-group").length;i++){
                    if($("#modal-list .form-group").eq(i).find("input").attr("type")=="file"){
                        alert("请先上传图片");
                        return;
                    }else{
                            data[$("#modal-list .form-group").eq(i).find("input").attr("name")] = $("#modal-list .form-group").eq(i).find("input").val();
                    }
                };
                console.log(data);
                var longreg =data.longitude;
                var latreg =data.latitude;
                if(/^-?(([1-9]\d?)|(1[1-7]\d)|180)(\.\d{1,10})?$/.test(longreg)){
                    if(/^-?(([1-9])|([1-8]\d)|90)(\.\d{1,10})?$/.test(latreg)){
                        if(data.storeName.length<40&data.storeName.length>0&data.storeName!==" "){
                             if (data.positionName.length<50&data.positionName.length>0&data.positionName!==" "){
                                 data.access_token = sessionStorage.access_token;
                                 data.from = "web";
                                 data.updateUser = sessionStorage.id;
                                 data.timestamp = parseInt(new Date().getTime()/1000);

                                 var newObj = srotKeyObj(data);
                                 var str = objmd5(newObj);

                                 var newUrl = url + "store/update?" + str;
                                 console.log(newUrl);

                                $.ajax({
                                    url:newUrl,
                                    type:'get',
                                    success:function(data){
                                        console.log(data);
                                        console.log("ok");
                                        alert("修改成功");
                                        location.reload();
                                    },
                                    error:function(err){
                                        console.log(err);
                                        console.log("err");                                       
                                    }
                                });
                             }else {
                                 alert("店铺地址输入错误且不能超过50个字符!");
                             }
                        }else {
                            alert("店铺名称输入错误且不能超过40个字符!");
                        }
                    } else {
                         alert("纬度输入错误!");
                    }
                }else {
                    alert("经度输入错误!");
                }
            }
        });

        //在售商品
        $(document).on("click",".goodsOne",function(e){
            console.log("goodsOne");
            $(this).addClass('active');
            $(this).siblings('button').removeClass('active');
            $('.find-goods-btn').html("查看在售");            
            $('.find-goods-btn').data('api','product/findOnSaleByStoreId?');
            findOnSaleByStoreId(storeId,$(this).data("api"),1,'');
            $(".modifyGoods").data("api","storeProduct/delList?");
            $(".modifyGoods").html("下架选中商品");
            // console.log("//");            
        });
        //未上架商品
        $(document).on("click",".goodsTwo",function(e){
            console.log("goodsTwo");
            $(this).addClass('active');
            $(this).siblings("button").removeClass('active');
            $('.find-goods-btn').data('api','product/findNoSaleByStoreId?');
            $('.find-goods-btn').html("查看未售");
            findOnSaleByStoreId(storeId,$(this).data("api"),1,'');
            $(".modifyGoods").data("api","storeProduct/saveList?");
            $(".modifyGoods").html("上架选中商品");
        });

        //商品点击按钮
        $(document).on("click",".modifyGoods",function(e){
            console.log($(this).data("api"));
            console.log("123");
            console.log($(this).parents().find('ul li input').length);
            var ids = [];
            for(let i = 0;i<$(this).parents().find('ul li input').length;i++){
                if($(this).parents().find('ul li input').eq(i).is(':checked')){
                    ids.push($(this).parents().find('ul li input').eq(i).data("id"));
                };
            }
            console.log(ids);
            if(ids.length!=0){
                var obj = {};
                obj.ids = ids;
                obj.storeId = storeId;
                obj.access_token = sessionStorage.access_token;
                obj.timestamp = parseInt(new Date().getTime()/1000);
                obj.from = "web";

                var newobj = srotKeyObj(obj);
                var str = objmd5(newobj);

                var newUrl = url + $(this).data("api") + str ;
                console.log(newUrl);
                $.ajax({
                    url:newUrl,
                    type:'get',
                    dataType:'json',
                    success:function(data,status,fn){
                        if(data.code == "200"){
                            console.log("商店添加商品成功");
                            console.log(data);
                            findOnSaleByStoreId(storeId,sessionStorage.findGoodsApi,1,'');                  
                        }else{
                            console.log("商店添加商品没有成功");
                        }
                    },
                    error:function(fn){
                        console.log(fn);
                    }
                });
            }else{
                alert("请勾选下架的商品");
            }
        });

        //根据店铺ID查询该店铺已绑定的商品并将其展示到模态框上
        function findOnSaleByStoreId(id,api,pageNum,name){
            var obj = {};
            if(name==''){
            }else{
                obj.name = name;
            }
            obj.access_token = sessionStorage.access_token;
            obj.storeId = id;
            obj.pageNum = pageNum;
            obj.pageSize = 10;
            sessionStorage.findGoodsApi = api;
            obj.timestamp = parseInt(new Date().getTime()/1000);
            obj.from = "web";
            
            var newobj = srotKeyObj(obj);
            var str = objmd5(newobj);

            var newUrl = url + api + str ;
            console.log(newUrl);

            $.ajax({
                url:newUrl,
                type:'get',
                success:function(data){
                    console.log(data);
                    // console.log("商品的录入");
                    var goodsList = "";
                    for(var i = 0; i < data.data.list.length;i++){
                        if(data.data.list[i].storeProductId == null){
                            productId = data.data.list[i].id ;
                        }else{
                            productId = data.data.list[i].storeProductId ;
                        }
                        goodsList += '<li class="goods-li" >'+data.data.list[i].name+'<div class="goodsCheck"><input value="'+data.data.list[i].id+'" data-id="'+productId+'" type="checkbox"></div></li>';
                    };
                    $(".goods-ul").html(goodsList);
                    // $("").html();
                    console.log("ok");
                    $('.goods-page-ul').html("");
                    $('.goods-page-ul').append("<li data-id='"+data.data.prePage+"'><</li>");

                    if(data.data.pages > 5){
                        if(data.data.pageNum < 3){
                          for(var i = 1 ; i < 4 ; i++){
                              if(data.data.pageNum == i){
                                $('.goods-page-ul').append("<li data-id="+i+">"+i+"</li>").find("li").eq(i).css({"color":"red"});                                  
                              }else{
                                $('.goods-page-ul').append("<li data-id="+i+">"+i+"</li>"); 
                              }                         
                          };
                          $('.goods-page-ul').append("<li data-id="+"..."+">"+"..."+"</li>");
                          $('.goods-page-ul').append("<li data-id="+data.data.pages+">"+data.data.pages+"</li>");
                        }else if(data.data.pageNum == 3){
                            $('.goods-page-ul').append("<li data-id="+1+">"+1+"</li>");                           
                            $('.goods-page-ul').append("<li data-id="+2+">"+2+"</li>");
                            $('.goods-page-ul').append("<li data-id="+3+">"+3+"</li>").find("li").eq(3).css({"color":"red"});
                            $('.goods-page-ul').append("<li data-id="+4+">"+4+"</li>");
                            $('.goods-page-ul').append("<li data-id="+"..."+">"+"..."+"</li>");
                            $('.goods-page-ul').append("<li data-id="+data.data.pages+">"+data.data.pages+"</li>");            
                        }else if(data.data.pageNum-3 > 0){
                                $('.goods-page-ul').append("<li data-id="+1+">"+1+"</li>");
                                $('.goods-page-ul').append("<li data-id="+"..."+">"+"..."+"</li>");
                            if(data.data.pages-data.data.pageNum >= 3){
                                $('.goods-page-ul').append("<li data-id="+data.data.prePage+">"+data.data.prePage+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.pageNum+" style='color:red'>"+data.data.pageNum+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.nextPage+">"+data.data.nextPage+"</li>");
                                $('.goods-page-ul').append("<li data-id="+"..."+">"+"..."+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.pages+">"+data.data.pages+"</li>");
                            }else if(data.data.pages-data.data.pageNum == 2){
                                $('.goods-page-ul').append("<li data-id="+data.data.prePage+">"+data.data.prePage+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.pageNum+" style='color:red'>"+data.data.pageNum+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.nextPage+">"+data.data.nextPage+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.pages+">"+data.data.pages+"</li>");
                            }else if(data.data.pages-data.data.pageNum == 1){
                                $('.goods-page-ul').append("<li data-id="+data.data.prePage+">"+data.data.prePage+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.pageNum+" style='color:red'>"+data.data.pageNum+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.pages+">"+data.data.pages+"</li>");
                            }else if(data.data.pages-data.data.pageNum == 0){
                                $('.goods-page-ul').append("<li data-id="+data.data.prePage+">"+data.data.prePage+"</li>");
                                $('.goods-page-ul').append("<li data-id="+data.data.pages+" style='color:red'>"+data.data.pages+"</li>");
                            }
                        }
                    }else{
                        for(let i = 0; i<data.data.pages;i++){
                            var k = i + 1;
                            if(k == data.data.pageNum){
                            $('.goods-page-ul').append("<li data-id="+k+">"+k+"</li>").find("li").eq(k).css({"color":"red"});                            
                            }else{
                            $('.goods-page-ul').append("<li data-id="+k+">"+k+"</li>");                         
                            }
                        };          
                };
                $('.goods-page-ul').append("<li data-id='"+data.data.nextPage+"'>></li>");
                },
                error:function(err){
                    console.log(err);
                    console.log("err");
                }
            });
        };

        //商品分类跳转
        $(document).on('click','.goods-page-ul li',function(){
            console.log($(this).data('id'));
            if($(this).data("id")=="..."||$(this).data("id")=="0"){
            }else{
                findOnSaleByStoreId(storeId,sessionStorage.findGoodsApi,$(this).data('id'),'');
            }
        });

        //根据id查询店铺
        // $(".findStort").on("click",function(e){
            if(sessionStorage.access_token!==undefined){
                var obj = {};
                // obj.storeName=search_input1;
                obj.access_token = sessionStorage.access_token;
                obj.id=sessionStorage.storeId;
                obj.timestamp = parseInt(new Date().getTime()/1000);
                obj.from = "web";
                var newobj = srotKeyObj(obj);
                var str = objmd5(newobj);
                var newUrl = url + "store/findById?" + str ;
                console.log(newUrl);
                $.ajax({
                url:newUrl,
                type:'get',
                success:function(data){
                    console.log(data);
                    console.log("数据查询成功 ok");

                    sessionStorage.printer = data.data.printer;
                    if(sessionStorage.jumpFlag == "ok"){
                    }else{
                        sessionStorage.jumpFlag = "ok";
                        location.href= "store-order.html";
                    }
                    
                    
                    // if(data.data.length==0){
                    //     alert("未找到该店铺 请核对信息 再次查找");
                    // }else{
                    //     var listNode ="";
                        // for(var i = 0; i < data.data.length;i++){
                       var listNode = '<div class="panel panel-default"><div class="panel-heading" role="tab" id="heading'+data.data.id+'"><h4 class="panel-title" style="padding-top:0px;">'
                        +  '<a class="collapased" role="button" data-toggle="collapse" style="min-width:400px;display: inline-block;" data-parent="#accordion" href="#collapse'+data.data.id+'" style="min-width:200px;" aria-expanded="false" aria-controls="collapse'+data.data.id+'">'
                        + data.data.storeName
                        + '</a>'
                        + '<button type="button" style="margin-right:20px;" class="btn btn-primary admin-btn" data-api="store/update?" data-toggle="modal" data-target="#exampleModal" data-whatever="修改店铺"'
                        + 'data-list="id_店铺id:^:'+data.data.id+'3&%_%&storeName_店铺名:^:'+data.data.storeName+'0&%_%&longitude_经度坐标:^:'+data.data.longitude+'0&%_%&latitude_纬度坐标:^:'+data.data.latitude+'0&%_%&positionName_地址名称:^:'+data.data.positionName+'0&%_%&printer_打印设备名称:^:'+data.data.printer+'0">修改店铺</button>'
                        + '<button type="button" class="btn btn-primary goodsManage" data-toggle="modal" data-target=".bs-example-modal-lg" data-id = '+data.data.id+'>商品管理</button>'
                        + '</h4></div>'
                        + '<div id="collapse'+data.data.id+'" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">'
                        + '<div class="panel-body">'
                        + '<div class="panel-body">'
                        + '<li class="list-group-item">'
                        + '<span>店铺名称:</span>'
                        + '<span class="store-num">'+data.data.storeName+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>经度坐标:</span>'
                        + '<span class="store-num">'+data.data.longitude+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>纬度坐标:</span>'
                        + '<span class="store-num">'+data.data.latitude+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>地址名称:</span>'
                        + '<span class="store-num">'+data.data.positionName+'</span>'
                        + '</li>'
                        // + '<li class="list-group-item">'
                        // + '<span>创建时间:</span>'
                        // + '<span class="store-num">'+data.data.createTime+'</span>'
                        // + '</li>'
                        + '</ul></div></div></div></div>'
                    // };
                    $('.panel-group').html(listNode);
                    // };
                },
                error:function(err){
                    console.log(err);
                    console.log("err");
                }
            });
            }

        // });

        //商品管理 模态框的管理
        $(document).on('click',".goodsManage",function(e){
            console.log($(this).data("id"));
            $('.goodsModal').modal("show");
            $('.goodsOne').addClass('active');
            $('.goodsTwo').removeClass('active');
            $('.modifyGoods').data("api","storeProduct/delList?");
            $(".modifyGoods").html("下架选中商品");
            var api = "product/findOnSaleByStoreId?";
            storeId = $(this).data("id");
            findOnSaleByStoreId(storeId,api,1,'');
        });

        //模糊查询商品
        $(".find-goods-btn").on('click',function(e){
            console.log($(this).data("api"));
            console.log($('.select-goods').val());
            if($('.select-goods').val()!==""){
                findOnSaleByStoreId(storeId,$(this).data("api"),1,$('.select-goods').val());
            }else{
                alert("请输入商品");
            };
        });
        


        /*
		 *对象key值排序
		 *@paremet 对象
		 */
		function srotKeyObj(obj){
            var arr = [];
            var newobj = {};
            for(var key in obj){
                arr.push(key);
            }
            arr.sort();
            var i=0;
            for(var key in obj){
                newobj[arr[i]] = obj[arr[i]];
                i++;
            };
            return newobj;
        }
        /*
         *加密获取签名
         *@paramet 对象
         */
         function objmd5(obj){
            var str = '';
            for(var key in obj){
                // if(obj[key] instanceof Array){
                //      for(var i in obj[key]){
                //          str += key+'[]='+obj[key][i]+'&'; 
                //      }
                // }else{
                str +=  key +"="+ obj[key] + "&";                    
                }
            // }
            var newstr = str.substr(0,str.length-1);
            var encodeStr = encodeURIComponent(newstr) + mykey;
            console.log(encodeStr);
            encodeStr = encodeStr.replace(/\(/g,'%28');
            encodeStr = encodeStr.replace(/\)/g,'%29');
            var sign = md5(encodeStr);
            newstr += "&sign=" + sign;
            return newstr;
         }
    })();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="myadmin/assets/css/bootstrap.css" rel="stylesheet" />
    <link href="myadmin/assets/css/font-awesome.css" rel="stylesheet" />
    <link href="myadmin/assets/js/morris/morris-0.4.3.min.css" rel="stylesheet" />
    <link href="myadmin/assets/css/custom-styles.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" >
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link href="myadmin/css/common.css" rel="stylesheet">
    <!-- <link href='http://fonts.useso.com/css?family=Open+Sans' rel='stylesheet' type='text/css' /> -->
    <title>Document</title>
</head>
<style>
    .data-title{
        height: 44px;
        margin-bottom: 20px;
        background: #fff;
    }
    .data-title p{
        padding:12px 0 0 12px;
    }
    .data-body{
        width: 100px;
        overflow: auto;
    }
    .body-left-ul li:hover{
        background: #575757;
        color: #F36A5A;  
    }
    .body-data-box{
        height: 120px;
        width: 100%;
        padding-right: 10px;
        background: white;
    }
    .row-box{
        padding:15px;
    }
    .body-data-num{
        padding: 0px;
    }
    .body-data-name{
        padding: 0px 0px 0px 20px;
        font-size: 16px;
        color: #AAB5BC;
        font-weight: 600;
        text-transform: uppercase;        
    }
    .body-data-num{
        padding: 30px 0px 0px 20px;
        font-size: 32px;
        font-weight: 600;
        color: #676767;
    }
    .user-manage li{
        height: 40px;
        line-height: 40px;
        padding: 5px 0px;
        margin: 20px 0px;     
    }
    .user-manage li input{
        width: 450px;
        margin-right: 20px;
        padding-left: 10px;
    }
    .add-user {
        height: 24px;
        position: relative;
        overflow: hidden;
        margin-top:40px;
        /* overflow:visible; */
    }
    #add-user-btn{
        display: inline-block;
        padding: 0 10px;
        width: 35px;
        height: 24px;
        margin-left: 20px;
    }
    .input-user{
        width: 450px;
        height: 30px;
        position: absolute;
        top: 30px;
    }
    .input-user input{
        width: 400px;
        height: 35px;
        padding-left: 10px;
    }
    .user-manage button{
        padding: 0px 10px;
        margin: 0px 2px;
    }
    .input-user button{
        height: 34px;
        margin: 0 2px;
        padding: 0 5px;
    }

    .page-ul li{
        float: left;
        /* width: 24px; */
        height: 24px;
        padding: 0px 6px;
        border: 1px solid gray;
        text-align: center;
        cursor: pointer;
    }
    .page-ul li:hover{
        background: #fff;
    }
    .mymodal{
        margin-top:50px;
    }
</style>
<body>
    <div class="admin-container">
        <div class="admin-nav">
            <div class="admin-nav-left">联家管理系统</div>
            <div class="admin-nav-right">
            <div class="back-login"><a href="#">退出登录</a></div>
            </div>
        </div>
        <div class="body">
            <div class="body-left">
                <ul class="body-left-ul">
                    <li><a href="./index.html">首页</a></li>
                    <li><a href="./control.html">控制面板</a></li>
                    <li><a href="./store.html">店铺管理</a></li>
                    <li><a href="./commodity.html">商品管理</a></li>
                    <li><a href="./order.html">订单详情</a></li>
                    <li><a href="./user.html">用户管理</a></li>
                    <li><a href="./address.html">地址管理</a></li>
                    <li class="active"><a href="./advertising.html">广告公告</a></li>
                    <li><a href="./classification.html">商品分类</a></li>
                    <li><a href="./store_manage.html">店长管理</a></li>                  
                    <li><a href="./courier.html">店员管理</a></li>
                    <li><a href="./integral.html">积分管理</a></li>
                    <li><a href="./coupon.html">优惠券管理</a></li>
                </ul>
            </div>
            <div class="body-right">
            <div class="body-right-title">广告公告</div>
            <div class="body-right-data">
                    <div class="add-advertising" style="padding-bottom:30px;">
                        <button type="button" class="btn btn-primary admin-btn" data-toggle="modal" data-api="banner/add?" data-target="#exampleModal" data-whatever="添加广告"
                        data-list="name_名称:^:|*-*|0&%_%&url_链接地址:^:|*-*|0&%_%&order_显示顺序:^:|*-*|0&%_%&begin_开始显示时间:^:|*-*|8&%_%&end_结束显示时间:^:|*-*|8&%_%&img_图片:^:|*-*|9">添加广告</button>                   
                    </div>
                    <ul class="store-manage">                        
                            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                    <!-- <div class="panel panel-default">
                                      <div class="panel-heading" role="tab" id="headingOne1">
                                        <h4 class="panel-title">
                                          <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                             生鲜水果全场五折
                                          </a>
                                        </h4>
                                      </div>
                                      <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                                        <div class="panel-body">
                                                <ul class="list-group">
                                                        <li class="list-group-item">
                                                            <span>描述:</span>
                                                            <span class="store-num">生鲜水果全场五折</span>
                                                            <button>修改</button>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <span>上传人:</span>
                                                            <span>张三 </span>
                                                            <span>电话：1888888888888</span>
                                                            <button>修改</button>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <span>截止时间：</span>
                                                            <span>2018.12.31 / 00:00</span>
                                                            <button>修改</button>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <span class="">广告顺序</span>
                                                            <span class="">1</span>
                                                            <button>修改</button>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <span class="">图片路径</span>
                                                            <span class="">http://www.lianjianshangwu.com/images/1.png</span>
                                                            <button>修改</button>
                                                        </li>                                                 
                                                </ul>
                                        </div>
                                      </div>
                                    </div>
    
    
    
                                    <div class="panel panel-default">
                                            <div class="panel-heading" role="tab" id="headingTwo">
                                              <h4 class="panel-title store-panel">
                                                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                                                    各种好品 全场9折 可享折上折
                                                </a>
                                              </h4>
                                            </div>
                                            <div id="collapseTwo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                                              <div class="panel-body">
                                                    <ul class="list-group">
                                                            <li class="list-group-item">
                                                                <span>描述:</span>
                                                                <span class="store-num"> 各种好品 全场9折 可享折上折</span>
                                                                <button>修改</button>
                                                            </li>
                                                            <li class="list-group-item">
                                                                    <span>上传人:</span>
                                                                    <span>张四 </span>
                                                                    <button>修改</button>
                                                            </li>
                                                            <li class="list-group-item">
                                                                <span>截至时间：</span>
                                                                <span>2018.12.31/00：00：00</span>
                                                                <button>修改</button>
                                                            </li>
                                                            <li class="list-group-item">
                                                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                                                                    店铺商品
                                                                </a>
                                                                <button class="">增加商品</button>
                                                                <div id="collapseSix" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingSix">
                                                                    <div class="panel-body">
                                                                            <ul class="list-group">
                                                                                <li class="list-group-item">
                                                                                    <span>西红柿： </span>
                                                                                    <span class="store-num">库存：50斤</span>
                                                                                    <span class="float right"></span>
                                                                                    <span class="right">售价：5元/斤</span>
                                                                                </li>
                                                                                <li class="list-group-item">
                                                                                    <span>红牛维生素功能饮料250毫升  </span>
                                                                                    <span class="store-num"> 库存：200瓶</span>
                                                                                    <span class="float right"> </span>
                                                                                    <span class="right">售价：6元每瓶</span>
                                                                                </li>
                                                                            </ul>
                                                                    </div>
                                                                </div>
                                                            </li>
        
                                                            <li class="list-group-item">
                                                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven">
                                                                    店铺店员
                                                                </a>
                                                                <button class="">增加店员</button>
                                                                <div id="collapseSeven" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingSeven">
                                                                    <div class="panel-body">
                                                                            <ul class="list-group">
                                                                                <li class="list-group-item">
                                                                                    <span>王六： </span>
                                                                                    <span class="store-num">年龄：25岁</span>
                                                                                    <span class="float right">职位：配送员</span>
                                                                                    <span class="right">电话：1888888888888</span>
                                                                                    <button>修改</button>
                                                                                </li>
                                                                                <li class="list-group-item">
                                                                                    <span>李六： </span>
                                                                                    <span class="store-num">年龄：25岁</span>
                                                                                    <span class="float right">职位：收银员</span>
                                                                                    <span class="right">电话：1888888888888</span>
                                                                                    <button>修改</button>
                                                                                </li>
                                                                            </ul>
                                                                    </div>
                                                                </div>
                                                            </li>                                                       
                                                    </ul>
                                              </div>
                                            </div>
                                          </div>
                                          <div class="page" style="padding-top:10px;">
                                              <ul class="page-ul">
                                              </ul>
                                              <div><input type="text" style="margin:0 5px 0px 20px;width:30px;text-align: center"><button>跳转</button></div>
                                          </div> -->
                                  </div>
                    </ul>
                <!-- <div class="add-advertising">
                    <span style="font-size: 16px;">&nbsp;修改广告</span>
                    <button id="add-advertising-btn">+</button>                   
                    <div class="input-advertising-btn" id="input-advertising-btn"><input type="text" placeholder="输入用户" /><button>修改</button></div>
                </div>   -->
            </div>
        </div>
        <div class="floor"></div>

        <div class="modal fade mymodal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">消息</h4>
                </div>
                <div class="modal-body append-form">
                    <!-- <div class="form-group">
                        <label for="recipient-name" class="control-label">修改客户</label>
                        <input type="text" class="form-control" id="recipient-name">
                    </div>
    
                    <ul class="list-group">
                        <li class="list-group-item">
                            <div class="form-group">
                                <label for="index" class="control-label">姓名</label>
                                <input type="text" class="form-control" id="index">
                            </div>
                            <div class="form-group">
                                <label for="index1" class="control-label">手机号</label>
                                <input type="text" class="form-control" id="index1">
                            </div>
                        </li>
                    </ul> -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" id="modal-commit">提交</button>
                </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script src="myadmin/assets/js/jquery-1.10.2.js"></script>
    <script src="myadmin/assets/js/bootstrap.min.js"></script>
    <script src="myadmin/assets/js/jquery.metisMenu.js"></script>
    
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
    <script type="text/javascript" src="myadmin/js/config.js"></script>
    <!-- <script src="../cdn/jquery3.3.1.min.js"></script>
    <script src="../cdn/md5.min.js"></script> -->
    <script>
        var $_331 = jQuery.noConflict();
        // var url = "http://192.168.1.108:8080/";
        // var mykey = "union_supermarket_2018";
        console.log(url);
        (function(){
        //动态生成page页
        $('.page ul').append("<li><</li>");
        for(var i = 0; i<5;i++){
            $('.page ul').append("<li>"+i+"</li>");
        };
        $('.page ul').append("<li>></li>");
        $("#headingOne1").on("click",function(){
            $('#collapseOne').collapse('toggle');
        });
        $('.collapse').collapse();


        //模态框的弹出
        $('#exampleModal').on('show.bs.modal', function(event){
            var button = $(event.relatedTarget);
            var recipient = button.data('whatever');
            var list = button.data('list');
            var a = list.split('&%_%&');
            // console.log(a);
            var obj = {};
            var arr = [];
            for(var i in a){
                // console.log(a[i]);
                arr[i] = [];
                arr[i][0] = a[i].split(":^:")[0];
                arr[i][1] = a[i].split(":^:")[1].substr(0,a[i].split(":^:")[1].length-1) == "|*-*|" ? "" : a[i].split(":^:")[1].substr(0,a[i].split(":^:")[1].length-1);
                arr[i][2] = a[i].split(":^:")[1].substr(a[i].split(":^:")[1].length-1,1);
            }
            // console.log(arr);
            
            //增加节点name_名字:0&%_%&age_年龄:1&%_%&phone_手机:2
            var appendNode = '<div class="form-group"><label for="recipient-name" class="control-label">内容'
            +'</label><input type="button" class="form-control" id="recipient-name" value="'+recipient
            +'" style="text-align:start"></div><ul class="list-group"><li class="list-group-item" id="modal-list">';
            
            for(var i = 0; i<arr.length ;i++){
                if(arr[i][2] == 9){
                    // console.log("添加图片");
                    appendNode +='<div class="form-group"><label for="exampleInputFile">选择图片</label><input id="img-input" type="file" filetype="image/*" name="'
                    +arr[i][0].split('_')[0]
                    +'"><p class="help-block"></p><button class="btn_img btn">点击上传</button></div>';
                }else if(arr[i][2] == 8){
                    appendNode +='<div class="form-group"><label for="'
                    +a[i].split(':^:')[0].split('_')[0]
                    +'" class="control-label">'
                    +a[i].split(':^:')[0].split('_')[1]
                    +'</label><input type="text" data-enable-time=true data-time_24hr=true  data-enable-seconds=true class="form-control flatpickr" id="index" name="'
                    +a[i].split(':^:')[0].split('_')[0]+'"></div>';
                }else{
                    appendNode += '<div class="form-group"><label for="'
                    +arr[i][0].split('_')[0]+'" class="control-label">'
                    +arr[i][0].split('_')[1]
                    +'</label><input type="text" class="form-control" id="'
                    +arr[i][0].split('_')[0]+'" name="'
                    +arr[i][0].split('_')[0]+
                    '" value="'
                    +arr[i][1]+
                    '"></div>';
                };
            }
            appendNode += '</li></ul>';
            $(".append-form").html(appendNode);
            document.getElementsByClassName("flatpickr").flatpickr();
            var modal = $(this);
            modal.find('.modal-title').text("管理");
            $("#modal-commit").data("api",button.data("api"));
            // modal.find('.modal-body input').val(recipient);
        });



        //模态框内容的提交
        $("#modal-commit").on('click',function(){

            var api = $(this).data("api");
            console.log(api);

            var data = {};
            // console.log($("#modal-list input").length);
            for(var i=0; i<$("#modal-list .form-group").length;i++){
                if($("#modal-list .form-group").eq(i).find("input").attr("type")=="file"){
                    alert("请先上传图片");
                    return;
                }else{
                    // if($("#modal-list input").eq(i).val() == ""){
                    //     alert("参数不能为空");
                    //     return;
                    // }else{
                    data[$("#modal-list .form-group").eq(i).find("input").attr("name")]= $("#modal-list input").eq(i).val();
                    // }

                }
            };

            if(api == "banner/add?"){ //广告添加

                // var data = {};
                // // console.log($("#modal-list input").length);
                // for(var i=0; i<$("#modal-list .form-group").length;i++){
                //     if($("#modal-list .form-group").eq(i).find("input").attr("type")=="file"){
                //         alert("请先上传图片");
                //         return;
                //     }else{
                //         // if($("#modal-list input").eq(i).val() == ""){
                //         //     alert("参数不能为空");
                //         //     return;
                //         // }else{
                //         data[$("#modal-list .form-group").eq(i).find("input").attr("name")]= $("#modal-list input").eq(i).val();
                //         // }
                //
                //     }
                // };

                // alert($("#name").val());
                // alert($("#url").val());
                //  alert($("#order").val());
                //  alert($(".form-group input[name='begin']").val());
                //  alert($(".form-group input[name='end']").val());
                if ($("#name").val()!==""){
                    if(/^[1-9]\d*$/.test($("#order").val())){

                        if ($(".form-group input[name='begin']").val()!==""){
                            if ($(".form-group input[name='end']").val()){
                                // if(/^[1-9]\d*$/.test($("#order").val())){

                                if(confirm("广告提交，请再次确认是否提交？")){
                                    console.log("this is file",data);
                                    data.access_token = sessionStorage.access_token;
                                    data.status = 0;
                                    data.from = "web";
                                    data.timestamp = parseInt(new Date().getTime()/1000);
                                    var newObj = srotKeyObj(data);
                                    var str = objmd5(newObj);

                                    var newUrl = url + "banner/add?" + str;
                                    console.log(newUrl);
                                    $.ajax({
                                        url:newUrl,
                                        type:'get',
                                        success:function(data){
                                            console.log(data);
                                            console.log("ok");
                                            alert("广告添加成功");
                                        },
                                        error:function(err){
                                            console.log(err);
                                            console.log("err");
                                            alert("广告添加失败");

                                        }
                                    });
                                    console.log(data);
                                }else {

                                }

                                // alert("提交成功!");

                                // }else {
                                //     alert("广告显示顺序只能输入正整数!");
                                // }

                            }else {
                                alert("广告结束显示时间不能为空!");
                            }

                        }else {
                            alert("广告开始显示时间不能为空!");
                        }

                    }else {
                        alert("广告显示顺序只能输入正整数!");
                    }

                }else {
                    alert("广告名称不能为空!")
                }

            }else if(api == "banner/modify?"){//广告修改

                // alert($(".form-group input[name='id']").val());
                // alert($(".form-group input[name='id']").val());

                // if ($(".form-group input[name='id']").val()==data.data[i].id){
                //
                // }else {
                //     alert("广告id不允许修改!")
                // }

                if ($("#name").val()!==""){
                    if ($(".form-group input[name='imagePath']").val()!==""){
                    if(/^[1-9]\d*$/.test($("#order").val())){
                        if ($(".form-group input[name='begin']").val()!==""){
                            if ($(".form-group input[name='end']").val()){
                                if ($(".form-group input[name='status']").val()!==""){

                                    if(confirm("广告修改，请再次确认是否修改？")) {
                                        console.log("this is file", data);
                                        data.access_token = sessionStorage.access_token;
                                        data.status = 0;
                                        data.from = "web";
                                        data.timestamp = parseInt(new Date().getTime()/1000);
                                        var newObj = srotKeyObj(data);
                                        var str = objmd5(newObj);
                                        
                                        var newUrl = url + "banner/modify?" + str;
                                        console.log(newUrl);
                                        $.ajax({
                                            url: newUrl,
                                            type: 'get',
                                            success: function (data) {
                                                console.log(data);
                                                console.log("ok");
                                                alert("广告修改提交成功");
                                                findAdvAll();
                                                $(".modal").modal("hide");
                                            },
                                            error: function (err) {
                                                console.log(err);
                                                console.log("err");
                                                alert("广告修改提交失败");
                                            }
                                        });
                                        // alert("提交成功!");
                                    }
                                }else {
                                    alert("广告结束显示时间(状态)不能为空!");
                                }
                            }else {
                                alert("广告结束显示时间不能为空!");
                            }

                        }else {
                            alert("广告开始显示时间不能为空!");
                        }

                    }else {
                        alert("广告显示顺序只能输入正整数!");
                    }

                 }else {
                    alert("广告图片路径不能为空!")
                }
                }else {
                    alert("广告名称不能为空!")
                }



            }else if(api == "banner/del?"){
                if(confirm("广告删除，请再次确认是否删除？")){
                    console.log("this is file",data);
                    data.access_token = sessionStorage.access_token;
                    // data.status = 1;
                    data.from = "web";
                    data.timestamp = parseInt(new Date().getTime()/1000);
                    var newObj = srotKeyObj(data);
                    var str = objmd5(newObj);

                    var newUrl = url + "banner/del?" + str;
                    console.log(newUrl);
                    $.ajax({
                        url:newUrl,
                        type:'get',
                        success:function(data){
                            console.log(data);
                            console.log("ok");
                            alert("广告删除成功");

                            // $(this).remove();

                        },
                        error:function(err){
                            console.log(err);
                            console.log("err");
                            alert("广告删除失败");

                        }
                    });
                    console.log(data);
                }else {

                }
            }

        });

        function findAdvAll(){
            var obj = {};
            obj.access_token = sessionStorage.access_token;
            obj.from = "web";
            obj.timestamp = parseInt(new Date().getTime()/1000);
            var newObj = srotKeyObj(obj);
            var str = objmd5(newObj);

            var newUrl = url+"banner/listAll?"+str;
            console.log(newUrl);

            $.ajax({
            url:newUrl,
            type:"get",
            dataType:"json",
            success:function(data){
                console.log(data);
                console.log("ok");



                var listNode = '';
                for(var i = 0; i < data.data.length;i++){
                    listNode += '<div class="panel panel-default"><div class="panel-heading" role="tab" id="heading'+data.data[i].id+'"><h4 class="panel-title" style="padding-top:0px;">'
                        +  '<a role="button" data-toggle="collapse" style="min-width:400px;display: inline-block;" data-parent="#accordion" href="#collapse'+data.data[i].id+'" style="min-width:200px;" aria-expanded="false" aria-controls="collapse'+data.data[i].id+'">'
                        + data.data[i].name
                        + '</a>'
                        + '<button type="button" style="margin-right:20px;" class="btn btn-primary admin-btn" data-api="banner/modify?" data-toggle="modal" data-target="#exampleModal" data-whatever="修改广告"'
                        + 'data-list="id_广告id:^:'+data.data[i].id+'0&%_%&name_名称:^:'+data.data[i].name+'0&%_%&url_链接地址:^:'+data.data[i].url+'0&%_%&imagePath_图片路径:^:'+data.data[i].imagePath+'0&%_%&order_广告显示顺序:^:'+data.data[i].order+'0&%_%&begin_广告开始显示时间:^:'+data.data[i].begin+'0&%_%&end_广告结束显示时间:^:'+data.data[i].end+'0&%_%&status_结束显示时间(状态):^:'+data.data[i].status+'0">修改广告</button>'
                        + '<button type="button" class="btn btn-primary admin-btn" data-api="banner/del?" data-toggle="modal" data-target="#exampleModal" data-whatever="删除广告"'
                        + 'data-list="id_广告id:^:'+data.data[i].id+'0">删除广告</button>'
                        + '</h4></div>'
                        + '<div id="collapse'+data.data[i].id+'" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">'
                        + '<div class="panel-body">'
                        + '<div class="panel-body">'
                        + '<li class="list-group-item">'
                        + '<span>名称:</span>'
                        + '<span class="store-num">'+data.data[i].name+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>链接地址:</span>'
                        + '<span class="store-num">'+data.data[i].url+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>广告显示顺序:</span>'
                        + '<span class="store-num">'+data.data[i].order+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>广告开始显示时间:</span>'
                        + '<span class="store-num">'+data.data[i].begin+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>广告结束显示时间:</span>'
                        + '<span class="store-num">'+data.data[i].end+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>图片路径:</span>'
                        + '<span class="store-num">'+data.data[i].imagePath+'</span>'
                        + '</li>'
                        + '<li class="list-group-item">'
                        + '<span>结束显示时间(0 启用，1 禁用):</span>'
                        + '<span class="store-num">'+data.data[i].status+'</span>'
                        + '</li>'
                        + '</ul></div></div></div></div>'
                }

                // listNode += '<div class="page" style="padding-top:10px;"><ul class="page-ul"></ul><div><input type="text" style="margin:0 5px 0px 20px;width:30px;"><button>跳转</button>   &nbsp;&nbsp;&nbsp;共&nbsp;'+data.data.pages+'&nbsp;页</div></div>'

                $('.panel-group').html(listNode);
                // $('.collapse').collapse();

            },
            error:function(err){
                console.log(err);
            }
        });

        }
        findAdvAll();
        


        /*
		 *对象key值排序
		 *@paremet 对象
		 */
		function srotKeyObj(obj){
            var arr = [];
            var newobj = {};
            for(var key in obj){
                arr.push(key);
            }
            arr.sort();
            var i=0;
            for(var key in obj){
                newobj[arr[i]] = obj[arr[i]];
                i++;
            };
            return newobj;
        }
        /*
         *加密获取签名
         *@paramet 对象
         */
         function objmd5(obj){
            var str = '';
            for(var key in obj){
                str +=  key +"="+ obj[key] + "&";
            }
            var newstr = str.substr(0,str.length-1);
            var encodeStr = encodeURIComponent(newstr) + mykey;
            encodeStr = encodeStr.replace(/\(/g,'%28');
            encodeStr = encodeStr.replace(/\)/g,'%29');
            var sign = md5(encodeStr);
            newstr += "&sign=" + sign;
            return newstr;
        }


        $(document).on('click','.btn_img',function(){//上传图片
            if($("#img-input")[0].files[0]){
                var reg = /image\/*/;
                var bloe = reg.test($("#img-input")[0].files[0].type);
                if(bloe){
                    var obj = {};
                    obj.access_token = sessionStorage.access_token;
                    obj.timestamp = parseInt(new Date().getTime()/1000);
                    obj.from = "web";
            
                    var newobj = srotKeyObj(obj);
                    var str = objmd5(newobj);
            
                    var arr = str.split("&");
            
                    var formData = new FormData();
                    for(var i = 0;i<arr.length;i++){
                        formData.append(arr[i].split("=")[0],arr[i].split("=")[1]);
                    }
                    formData.append('file', $("#img-input")[0].files[0]);  /*获取上传的图片对象*/
                    $_331.ajax({
                          url: url+'attachment/upload',
                          type: 'POST',
                          data: formData,
                          contentType: false,
                          processData: false,
                          success:function(data){
                              console.log(data);  /*服务器端的图片地址*/
                              alert("图片上传成功");
                              var str = data.data;
                              var node = '<label for="imagePath" class="control-label">图片路径</label><input type="text" class="form-control" id="imagePath"  name="imagePath" value="'
                              +str+
                              '">';
                              $('.btn_img').parent().html(node);
                     },
                        error:function(err){
                            console.log(err);
                            alert("图片上传失败");
                        }
                  });
            
                }else{
                    alert("请选择图片");
                }
            }else{
                alert("请选择图片");
            }

            // var str = "http://140.143.25.27:8080/attachment/view/46";
            // var node = '<label for="imagePath" class="control-label">图片路径</label><input type="text" class="form-control" id="imagePath"  name="imagePath" value="'
            //         +str+
            //         '">';
            // $(this).parent().html(node);
            
            
        });
    })();
    </script>
</body>
</html>
